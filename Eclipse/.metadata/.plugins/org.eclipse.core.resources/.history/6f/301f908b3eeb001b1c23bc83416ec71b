#include "timers.h"


/*          Global Variables        */
static volatile void (*g_Timer_0_Overflow_callBackPtr)(void) = NULL_PTR;
static volatile void (*g_Timer_0_Compare_callBackPtr)(void) = NULL_PTR;


/*          ISRs        */

ISR(TIMER0_COMP_vect)
{
    if (g_Timer_0_Compare_callBackPtr != NULL_PTR)
    {
        (*g_Timer_0_Compare_callBackPtr)();
    }
}

ISR(TIMER0_OVF_vect)
{
    if (g_Timer_0_Overflow_callBackPtr != NULL_PTR)
    {
        (*g_Timer_0_Overflow_callBackPtr)();
    }
}



/*Initialize timer 0 configuration*/
void Timer_0_init(const Timer_0_2_ConfigType * const cfg_ptr)
{
    /*insert all configuration settings in the control register*/
    TCCR0= ((~(cfg_ptr->mode&0b01))<<7)|((cfg_ptr->mode&0b01)<<6)|(cfg_ptr->com_mode<<4)|((cfg_ptr->mode&0b10)<<3)|cfg_ptr->clock;
    
    /*insert compare value to compare register*/
    OCR0=cfg_ptr->compare_value;
    
    /*Initialize current counter value to 0*/
    TCNT0=0;
}

  /*Set output compare value for timer0*/
void Timer_0_setCompareValue(const uint8 compare_val)
{
    /*insertcompare value to compare register*/
    OCR0=compare_val;
}

 /*Set current counter value for timer0*/
void Timer_0_setCounterValue(const uint8 counter_val)
{
    /*insert current counter value*/
    TCNT0=counter_val;
}

  /*Set compare mode isr callback*/
void Timer_0_setCompareCallBack(void (*f_ptr)(void))
{
    
    g_Timer_0_Compare_callBackPtr = f_ptr;

}

 /*Set overflow mode isr callback*/
void Timer_0_setOverflowCallBack(void (*f_ptr)(void))
{
    g_Timer_0_Overflow_callBackPtr = f_ptr;

}

 /*Enable compare mode Interrupt*/
void Timer_0_EnableCompareInterrupt(void (*f_ptr)(void))
{
    SET_BIT(TIMSK,OCIE);
}  
    
  /*Enable compare mode Interrupt*/
void Timer_0_EnableOverflowInterrupt(void (*f_ptr)(void))
{
    SET_BIT(TIMSK,TOIE0);
}  
  /*Disable compare mode Interrupt*/

void Timer_0_DisableCompareInterrupt(void (*f_ptr)(void))
{
    CLEAR_BIT(TIMSK,OCIE0);
} 
  /*Disable overflow mode Interrupt*/

void Timer_0_DisableOverflowInterrupt(void (*f_ptr)(void))
{
    CLEAR_BIT(TIMSK,OCIE0);
} 





void Timer_0_deInit(void)
{
    /*reset all registers and disable all interrupts*/
    TCCR0=0;
    OCR0=0;
    TCNT0=0;
    TIMSK&=~(0X03);
}

void Timer_0_setPrescalar(const Timer_0_2_ClockType clock)
{
    /*insert clock prescalar*/
    TCCR0=(TCCR0&(~0X07))|clock;
}
